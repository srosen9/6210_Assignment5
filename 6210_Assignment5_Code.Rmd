---
title: "Assignment5_Code"
author: "Stephanie Rosen"
date: "12/12/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction

# Description of Dataset



# Data Acquisition, Exploration, Filtering, and Quality Control

The packages we will be using are tidyverse, 

```{r Loading required packages, echo=FALSE}

library(tidyverse)
library(ggplot2)

```


We require two datasets for this project: (1) Community data for the wetlands and (2) Genetic data from NCBI 

```{r community data acquistion, exploration, filtering and quality control}

#import dataset
df_Odonata <- PEI_NP_Wetlands_Odonata_2010_2018_data

names(df_Odonata)
dim(df_Odonata)

#total number of unique species?
#73
#but lots of errors with species names. We will remove NA values, any species names that do not follow proper scientific naming procedures, and also any where the species level is not indicated. 


#remove chunks of text in brackets but still have full species names
df_Odonata$Scientific.name <- str_remove(string = df_Odonata$Scientific.name, "\\(.+\\)" )

#There are some species that have a third unecessary word in their name. We will remove that too.
#df_Odonata[str_detect(string = df_Odonata$Scientific.name, "^[A-z]+ [A-z]+ [A-z]+$"),]

df_Odonata$Scientific.name <- str_remove(string = df_Odonata$Scientific.name, "Walker" )
df_Odonata$Scientific.name <- str_remove(string = df_Odonata$Scientific.name, "Say" )

#remove first row (French header), scientific names with NA values, irrelevant columns, and any names that do not follow. 
df_Odonata <- df_Odonata[-1,] %>%
  filter(!is.na(Scientific.name)) %>%
  select(!exuvia.observer.number & !Observer..order.number & !note) %>%
  filter(str_detect(Scientific.name, "^[A-z]+ [A-z]+$")) %>%
  filter(!str_detect(Scientific.name, "NOT ODONATA"))

unique(df_Odonata$Scientific.name)

#Now that we have clean scientific names, let's look at the different ponds we have:
unique(df_Odonata$Survey.site)

#Ideas for looking into biodiversity
#pick one year and explore

df_sites <-
  df_Odonata %>%
  group_by(Year) %>%
  count(Survey.site)

df_counts_by_site <- 
  pivot_wider(df_sites, id_cols = Survey.site, names_from = Year, values_from = Year)

#from this table, we see that there were different sites measured every year. I chose to look at the sites that were measured continuously over the 10 year period. Let's look at the sites in common. That is the sites of Bell's pond, Bog Pond, and Bowley Pond

df_Odonata_common_sites <-
  df_Odonata %>%
  filter(Survey.site == "Bells Pond" | Survey.site == "Bog Pond" | Survey.site == "Bowley Pond")

#Now the df_Odonata_common sites data has all the data for the ponds measured every year. We are ready to explore the data.



```

Now we have clean scientific name data for our different communities. Let's explore the data

```{r data exploration}

#Exploring total number of counts at each pond
df_Odonata_counts_by_year_plot <- df_Odonata_common_sites %>%
  group_by(Survey.site) %>%
  count(Survey.site)

barplot(df_Odonata_counts_by_year_plot$n,
        names.arg = df_Odonata_counts_by_year_plot$Survey.site)

#Exploring total number of counts at each pond per year

df_Odonata_unique_by_year_pond <- df_Odonata_common_sites %>%
  group_by(Year, Survey.site) %>%
  summarise(n = n_distinct(Scientific.name))

ggplot(df_Odonata_unique_by_year_pond, 
       aes(fill=Survey.site, y=n, x=Year)) + 
  geom_bar(position="dodge", stat="identity") +
  labs(y = "Number of Unique Odonata Species", 
       title = "Number of Unique Odonata Species per Pond by Year") +
  scale_fill_manual(values = c("#D81B60","#1E88E5","#FFC107"), 
                    name = "Survey Site") +
  theme(plot.title = element_text(hjust = 0.5))



```

-we can see that there were a lot less species collected in 2014
-the biodiversity per year seems to vary quite a bit
-because we are only interested in the biodiversity of the ponds, for this analysis we will ignore the species counts and leave them for a future analysis
-we will investigate the unique species over the 10 year period, and then potentially for each year (maybe just 2008, 2012, and 2017?)


# Main Software Tools Description

# Main Analysis


```{r pressure, echo=FALSE}


```


#Results and Discussion

#Acknowledgements

#References